import Silla.*
import ingredientes.*
import coctelera.*
import cliente.*

import wollok.game.*

// Ingredientes
const naranja = new Ingredientes()
const limon = new Ingredientes()
const cocacola = new Ingredientes()
 
// Clientes
const clienteConformista = new ClienteConformista(silla = 1, tiempoEspera = 60)
const otroClienteConformista = new ClienteConformista(silla = 1, tiempoEspera = 60)
const clienteMedio = new ClienteMedio(silla = 2, tiempoEspera = 40)
const clienteExigente = new ClienteExigente(silla = 3, tiempoEspera = 60)


// Comienzan los tests sobre las Sillas
describe "Pruebas para la clase Silla y sus herederas" {
	
	test "evaluarEstado() sin cliente y con 100% de probabilidades, debe generar cliente" {
		
		const silla = new SillaParaTest(position = game.origin())
		
		assert.notThat(silla.estaOcupada())
		
		silla.evaluarEstado()
		
		assert.equals(silla.cliente().toString(), "un/a  Cliente")
	}
	
	test "Si la silla ya tiene un cliente, evaluarEstado() conserva el mismo cliente" {
		
		const silla = new SillaParaTest(position = game.origin())
		
		silla.evaluarEstado()
		
		const cliente = silla.cliente()
		
		silla.evaluarEstado()
		
		assert.that(silla.cliente() === cliente)
	}
	
	test "retirarCliente()" {
		
		const silla = new SillaParaTest(position = game.origin())
		
		silla.evaluarEstado()
		
		assert.equals(silla.cliente().toString(), "un/a  Cliente")
		
		silla.retirarCliente()
		
		assert.notThat(silla.estaOcupada())
	}
	
}


// Comienzan los tests sobre los Ingredientes y Coctelera
describe "Ingredientes" {
	test "Iniciliza vacio la cantidad de onzas"{
 		assert.equals(0, naranja.cantidadOnzas())
 	}
 	test "Aumtar onza"{
 		naranja.aumentarOnza()
	 	assert.equals(1, naranja.cantidadOnzas())	
 	}
}
 
describe "Coctelera" {
 	test "Agregar Ingredientes" {
 		coctelera.agregarIngredientes(naranja)
 		coctelera.agregarIngredientes(limon)
 		coctelera.agregarIngredientes(cocacola)
 		assert.equals([naranja, limon, cocacola], coctelera.ingredientes())
 	}
 	test "Aumetan Onzas" {
 		coctelera.agregarIngredientes(naranja)
 		assert.equals(1, coctelera.ingredientes().first().cantidadOnzas())
 		
 		coctelera.agregarIngredientes(limon)
 		assert.equals(1, coctelera.ingredientes().get(1).cantidadOnzas())
 		
 		coctelera.agregarIngredientes(naranja)
 		assert.equals(2, coctelera.ingredientes().first().cantidadOnzas())
 		
 		coctelera.agregarIngredientes(limon)
 		assert.equals(2, coctelera.ingredientes().get(1).cantidadOnzas())
 	}
 	
 	test "Limpiar coctelera" {
 		coctelera.agregarIngredientes(naranja)
 		coctelera.agregarIngredientes(limon)
 		coctelera.agregarIngredientes(cocacola)
 		coctelera.limpiar()
 		assert.that(coctelera.ingredientes().isEmpty())
 	}
}

describe "cliente"{
 	test "cliente conformista"{
 		
 		//al inicio
 		assert.equals(60, clienteConformista.timpoEspera())
 		assert.equals(null,clienteConformista.tragoPedido())
 		
 		//pido trago
 		//clienteConformista.generarTrago(_unTrago)
 		//assert.equals(_unTrago,clienteConformista.tragoPedido())
 		
 		//No recibi el trago
 		assert.notThat(clienteConformista.tragoRecibido())
 		
 		//recibo trago
 		//aca tiene que pasar algo desde el bartender
 		assert.that(clienteConformista.tragoRecibido())
 		
 		//comparar tragos (es el mismo)
 		assert.that(clienteConformista.verificarTrago())
 		
 		//como es el mismo trago modifico satisfaccion?
 		//este metodo llama a verificarTrago
 		clienteConformista.modificarSatisfaccion()
 		assert.equals(3,clienteConformista.satisfaccion())
 		
 		//deja propina acorde a la satisfaccion
 		assert.equals(100,clienteConformista.darPropina())
 		
 		
 		
 	}
 	
 	test "cliente medio"{
 		assert.equals(40, clienteMedio.timpoEspera())
 	}
 	
 	test "cliente exigente"{
 		assert.equals(20, clienteExigente.timpoEspera())
 	}
}
