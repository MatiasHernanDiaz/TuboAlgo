import silla.*
import sesion.*
import ingredientes.*
import coctelera.*
import cliente.*
import barman.*
import tragos.*

import wollok.game.*

// Ingredientes
//const naranja = new Ingrediente()
//const limon = new Ingrediente()
//const cocacola = new Ingrediente()
//const setIngredientes = #{}
 
// Clientes -> position? deberia pasar la misma posision de la silla...
const silla = new SillaParaTest(position = game.origin())
const clienteConformista = new ClienteConformista(silla = silla)
const clienteMedio = new ClienteMedio(silla = silla)
const clienteExigente = new ClienteExigente(silla = silla)


// Comienzan los tests sobre las Sillas
describe "Pruebas para la clase Silla y sus herederas" {
	
	test "evaluarEstado() sin cliente y con 100% de probabilidades, debe generar cliente" {
		
		const silla = new SillaParaTest(position = game.origin())
		
		assert.notThat(silla.estaOcupada())
		
		silla.evaluarEstado()
		
		assert.that(silla.cliente().toString().contains("un/a  Cliente"))
	}
	
	test "Si la silla ya tiene un cliente, evaluarEstado() conserva el mismo cliente" {
		
		const silla = new SillaParaTest(position = game.origin())
		
		silla.evaluarEstado()
		
		const cliente = silla.cliente()
		
		silla.evaluarEstado()
		
		assert.that(silla.cliente() === cliente)
	}
	
	test "retirarCliente()" {
		
		const silla = new SillaParaTest(position = game.origin())
		
		silla.evaluarEstado()
		
		assert.that(silla.cliente().toString().contains("un/a  Cliente"))
		
		silla.retirarCliente()
		
		assert.notThat(silla.estaOcupada())
	}
}

//Test para la Sesion
describe "Sesion" {
	test "Al iniciarse, todas sus sillas deben iniciarse y tener un cliente random" {
		const sesion = new SesionParaTest()
		
		sesion.iniciar()
		
		assert.equals(sesion.sillas().size(), 4)
		
		game.schedule(1100, {
			sesion.sillas().forEach({ 
				silla => assert.that(silla.cliente().toString().contains("un/a  Cliente"))
			})
		})
	}
}


// Comienzan los tests sobre los Ingredientes y Coctelera
describe "Ingredientes" {
	test "Iniciliza vacio la cantidad de onzas"{
 		assert.equals(0, naranja.cantidadOnzas())
 	}
 	test "Aumtar onza"{
 		naranja.aumentarOnza()
	 	assert.equals(1, naranja.cantidadOnzas())	
 	}
 	test "diferencia de ingredientes" {
 		assert.notThat(naranja.nombre() == limon.nombre())
 	}
}
 
describe "Coctelera" {
 	test "Agregar Ingredientes" {
 		coctelera.agregarIngredientes(naranja)
 		coctelera.agregarIngredientes(limon)
 		coctelera.agregarIngredientes(cocacola)
 		coctelera.agregarIngredientes(naranja)
 		setIngredientes.add(naranja)
 		setIngredientes.add(cocacola)
 		setIngredientes.add(limon)
 		assert.equals(setIngredientes, coctelera.ingredientes())
 	}
 	test "Aumetan Onzas" {
 		coctelera.agregarIngredientes(naranja)
 		assert.equals(1, coctelera.ingredientes().asList().get(0).cantidadOnzas())
 		
 		coctelera.agregarIngredientes(limon)
 		assert.equals(1, coctelera.ingredientes().asList().get(1).cantidadOnzas())
 		
// 		coctelera.agregarIngredientes(naranja)
// 		assert.equals(2, coctelera.ingredientes().asList().get(0).cantidadOnzas())
 	
 		coctelera.agregarIngredientes(limon)
 		assert.equals(2, coctelera.ingredientes().asList().get(1).cantidadOnzas())
 	}
 	
 	test "Limpiar coctelera" {
 		coctelera.agregarIngredientes(naranja)
 		coctelera.agregarIngredientes(limon)
 		coctelera.agregarIngredientes(cocacola)
 		coctelera.limpiar()
 		assert.that(coctelera.ingredientes().isEmpty())
 	}
 	
 	test "Compara ingredientes" {
 		coctelera.agregarIngredientes(naranja)
 		coctelera.agregarIngredientes(limon)
 		coctelera.agregarIngredientes(cocacola)
 		setIngredientes.add(naranja)
 		setIngredientes.add(cocacola)
 		setIngredientes.add(limon)
 		
 		assert.equals(setIngredientes, coctelera.ingredientes())
 	}
 	
 	test "Compara ingredientes false" {
 		coctelera.agregarIngredientes(naranja)
 		coctelera.agregarIngredientes(cocacola)
 		setIngredientes.add(naranja)
 		setIngredientes.add(limon)
 		
 		assert.notEquals(setIngredientes, coctelera.ingredientes())
 	}
}

describe "cliente"{
 	test "cliente conformista"{
 		//inicio
 		//assert.equals(60,clienteConformista.tiempoEspera())
 		assert.equals(30,clienteConformista.tiempoEspera()) //para el test
 		assert.equals(3,clienteConformista.satisfaccion())
 		assert.equals(null, clienteConformista.tragoPedido())
 		
 		//pide un fernet
 		clienteConformista.generarTrago(fernetCoca)
 		assert.equals(fernetCoca, clienteConformista.tragoPedido())
 		
 		//recibe fernet y lo verigica //NO SE PRUEBA recibeTrago(unTrago) rompe game.say()
 		assert.that(clienteConformista.verificarTrago(fernetCoca))
 		//recibe fernetCordobes
 		assert.that(clienteConformista.verificarTrago(fernetCordobes))
 		//recibe garibaldi
 		assert.notThat(clienteConformista.verificarTrago(garibaldi))
 		
 		
 	}
 	
 	test "cliente medio"{
 		//inicio
 		//assert.equals(40,clienteMedio.tiempoEspera())
 		assert.equals(20,clienteMedio.tiempoEspera())
 		assert.equals(3,clienteMedio.satisfaccion())
 		assert.equals(null, clienteMedio.tragoPedido())
 		
 		//pide un fernet
 		clienteMedio.generarTrago(fernetCoca)
 		assert.equals(fernetCoca, clienteMedio.tragoPedido())
 		
 		//recibe fernet y lo verigica //NO SE PRUEBA recibeTrago(unTrago) rompe game.say()
 		assert.that(clienteMedio.verificarTrago(fernetCoca))
 		//recibe fernetCordobes
 		assert.that(clienteMedio.verificarTrago(fernetCordobes))
 		//recibe garibaldi
 		assert.notThat(clienteMedio.verificarTrago(garibaldi))
 		//recibe otro trago
 		const otroTrago = new Trago(ingredientes = [fernet,fernet,naranja, naranja, naranja, campari, campari, campari])
		const otroTragoCambioUno = new Trago(ingredientes = [fernet,naranja,naranja, naranja, naranja, campari, campari, campari])
		const otroTragoCambioDos = new Trago(ingredientes = [fernet,naranja,naranja, naranja, naranja, naranja, campari, campari])
		const otroTragoCambioTres = new Trago(ingredientes = [fernet,naranja,naranja, naranja, naranja, naranja, naranja, campari])
		
		clienteMedio.generarTrago(otroTrago)
		assert.that(clienteMedio.verificarTrago(otroTragoCambioUno))
		assert.notThat(clienteMedio.verificarTrago(otroTragoCambioDos))
		assert.notThat(clienteMedio.verificarTrago(otroTragoCambioTres))
 	}
 	
 	test "cliente exigente"{
 		//inicio
 		//assert.equals(10,clienteExigente.tiempoEspera())
 		assert.equals(10,clienteExigente.tiempoEspera()) //para el test
 		assert.equals(3,clienteExigente.satisfaccion())
 		assert.equals(null, clienteExigente.tragoPedido())
 		
 		//pide un fernet
 		clienteExigente.generarTrago(fernetCoca)
 		assert.equals(fernetCoca, clienteExigente.tragoPedido())
 		
 		//recibe fernet y lo verigica //NO SE PRUEBA recibeTrago(unTrago) rompe game.say()
 		assert.that(clienteExigente.verificarTrago(fernetCoca))
 		//recibe fernetCordobes
 		assert.notThat(clienteExigente.verificarTrago(fernetCordobes))
 		//recibe garibaldi
 		assert.notThat(clienteExigente.verificarTrago(garibaldi))
 		//recibe otro trago
 		const otroTrago = new Trago(ingredientes = [fernet,fernet,naranja, naranja, naranja, campari, campari, campari])
		const otroTragoCambioUno = new Trago(ingredientes = [fernet,naranja,naranja, naranja, naranja, campari, campari, campari])
		const otroTragoCambioDos = new Trago(ingredientes = [fernet,naranja,naranja, naranja, naranja, naranja, campari, campari])
		const otroTragoCambioTres = new Trago(ingredientes = [fernet,naranja,naranja, naranja, naranja, naranja, naranja, campari])
		
		clienteExigente.generarTrago(otroTrago)
		assert.notThat(clienteExigente.verificarTrago(otroTragoCambioUno))
		assert.notThat(clienteExigente.verificarTrago(otroTragoCambioDos))
		assert.notThat(clienteExigente.verificarTrago(otroTragoCambioTres))
 		
 	}
}

describe "barman"{
	test "cocacola con naranja y limon"{
		barman.agregarIngrediente(naranja)
		barman.agregarIngrediente(limon)
		barman.agregarIngrediente(cocacola)
		barman.derecha()
		barman.derecha()
		barman.seleccionar()
		barman.derecha()
		barman.seleccionar()
		barman.izquierda()
		barman.izquierda()
		barman.seleccionar()
		
		setIngredientes.add(naranja)
 		setIngredientes.add(cocacola)
 		setIngredientes.add(limon)
		
		assert.that(coctelera.ingredientes() == setIngredientes)
	}
}
