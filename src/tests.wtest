import silla.*
import sesion.*
import ingredientes.*
import coctelera.*
import cliente.*
import barman.*

import wollok.game.*

// Ingredientes
const naranja = new Ingredientes(nombre = "naranja")
const limon = new Ingredientes(nombre = "limon")
const cocacola = new Ingredientes(nombre = "cocacola")
const setIngredientes = #{}
 
// Clientes -> position? deberia pasar la misma posision de la silla...
const silla = new SillaParaTest(position = game.origin())
const clienteConformista = new ClienteConformista(silla = silla)
const clienteMedio = new ClienteMedio(silla = silla)
const clienteExigente = new ClienteExigente(silla = silla)


// Comienzan los tests sobre las Sillas
describe "Pruebas para la clase Silla y sus herederas" {
	
	test "evaluarEstado() sin cliente y con 100% de probabilidades, debe generar cliente" {
		
		const silla = new SillaParaTest(position = game.origin())
		
		assert.notThat(silla.estaOcupada())
		
		silla.evaluarEstado()
		
		assert.that(silla.cliente().toString().contains("un/a  Cliente"))
	}
	
	test "Si la silla ya tiene un cliente, evaluarEstado() conserva el mismo cliente" {
		
		const silla = new SillaParaTest(position = game.origin())
		
		silla.evaluarEstado()
		
		const cliente = silla.cliente()
		
		silla.evaluarEstado()
		
		assert.that(silla.cliente() === cliente)
	}
	
	test "retirarCliente()" {
		
		const silla = new SillaParaTest(position = game.origin())
		
		silla.evaluarEstado()
		
		assert.that(silla.cliente().toString().contains("un/a  Cliente"))
		
		silla.retirarCliente()
		
		assert.notThat(silla.estaOcupada())
	}
}

//Test para la Sesion
describe "Sesion" {
	test "Al iniciarse, todas sus sillas deben iniciarse y tener un cliente random" {
		const sesion = new SesionParaTest()
		
		sesion.iniciar()
		
		assert.equals(sesion.sillas().size(), 4)
		
		game.schedule(1100, {
			sesion.sillas().forEach({ 
				silla => assert.that(silla.cliente().toString().contains("un/a  Cliente"))
			})
		})
	}
}


// Comienzan los tests sobre los Ingredientes y Coctelera
describe "Ingredientes" {
	test "Iniciliza vacio la cantidad de onzas"{
 		assert.equals(0, naranja.cantidadOnzas())
 	}
 	test "Aumtar onza"{
 		naranja.aumentarOnza()
	 	assert.equals(1, naranja.cantidadOnzas())	
 	}
 	test "diferencia de ingredientes" {
 		assert.notThat(naranja.nombre() == limon.nombre())
 	}
}
 
describe "Coctelera" {
 	test "Agregar Ingredientes" {
 		coctelera.agregarIngredientes(naranja)
 		coctelera.agregarIngredientes(limon)
 		coctelera.agregarIngredientes(cocacola)
 		coctelera.agregarIngredientes(naranja)
 		setIngredientes.add(naranja)
 		setIngredientes.add(cocacola)
 		setIngredientes.add(limon)
 		assert.equals(setIngredientes, coctelera.ingredientes())
 	}
 	test "Aumetan Onzas" {
 		coctelera.agregarIngredientes(naranja)
 		assert.equals(1, coctelera.ingredientes().asList().get(0).cantidadOnzas())
 		
 		coctelera.agregarIngredientes(limon)
 		assert.equals(1, coctelera.ingredientes().asList().get(1).cantidadOnzas())
 		
// 		coctelera.agregarIngredientes(naranja)
// 		assert.equals(2, coctelera.ingredientes().asList().get(0).cantidadOnzas())
 	
 		coctelera.agregarIngredientes(limon)
 		assert.equals(2, coctelera.ingredientes().asList().get(1).cantidadOnzas())
 	}
 	
 	test "Limpiar coctelera" {
 		coctelera.agregarIngredientes(naranja)
 		coctelera.agregarIngredientes(limon)
 		coctelera.agregarIngredientes(cocacola)
 		coctelera.limpiar()
 		assert.that(coctelera.ingredientes().isEmpty())
 	}
 	
 	test "Compara ingredientes" {
 		coctelera.agregarIngredientes(naranja)
 		coctelera.agregarIngredientes(limon)
 		coctelera.agregarIngredientes(cocacola)
 		setIngredientes.add(naranja)
 		setIngredientes.add(cocacola)
 		setIngredientes.add(limon)
 		
 		assert.equals(setIngredientes, coctelera.ingredientes())
 	}
 	
 	test "Compara ingredientes false" {
 		coctelera.agregarIngredientes(naranja)
 		coctelera.agregarIngredientes(cocacola)
 		setIngredientes.add(naranja)
 		setIngredientes.add(limon)
 		
 		assert.notEquals(setIngredientes, coctelera.ingredientes())
 	}
}

describe "cliente"{
 	test "cliente conformista"{
 		//inicio
 		assert.equals(60,clienteConformista.tiempoEspera())
 		assert.equals(3,clienteConformista.satisfaccion())
 		assert.equals(null, clienteConformista.tragoPedido())
 		
 		//pide un fernet (momentaneamente botella con 1 onza)
 		const fernetTest = new BotellaFernet()
 		clienteConformista.generarTrago(fernetTest)
 		assert.equals(fernetTest, clienteConformista.tragoPedido())
 		
 		//recibe trago
 		//const unTrago = new BotellaFernet() NO SE PUEDE NO ENTIENDE EL METHOD INGREDIENTE
 		//clienteConformista.recibirTrago(unTrago)
 		//assert.notThat(clienteConformista.verificarTrago())
 		
 		//dar propina FUNCA, PERO DA ERROR POR EL game.say POR NO ESTAR EN EL TABLERO
 		//AVERIGUAR FORMA DE PROBAR ESTO SIN QUE SE ROMPA POR ESA TONTERIA
 		assert.equals(0, propinero.dineroTotal())
 		//clienteConformista.darPropina()
 		//assert.equals(1000, propinero.dineroTotal())
 		
 	}
 	
 	test "cliente medio"{
 		//inicio
 		assert.equals(40,clienteMedio.tiempoEspera())
 		assert.equals(3,clienteMedio.satisfaccion())
 		assert.equals(null, clienteMedio.tragoPedido())
 		
 		//pide un fernet (momentaneamente botella con 1 onza)
 		const fernetTest = new BotellaFernet()
 		clienteMedio.generarTrago(fernetTest)
 		assert.equals(fernetTest, clienteMedio.tragoPedido())
 		
 		//recibe trago
 		//const unTrago = new BotellaFernet() NO SE PUEDE NO ENTIENDE EL METHOD INGREDIENTE
 		//clienteMedio.recibirTrago(unTrago)
 		//assert.notThat(clienteMedio.verificarTrago())
 		
 		//dar propina FUNCA, PERO DA ERROR POR EL game.say POR NO ESTAR EN EL TABLERO
 		//AVERIGUAR FORMA DE PROBAR ESTO SIN QUE SE ROMPA POR ESA TONTERIA
 		assert.equals(0, propinero.dineroTotal())
 		//clienteMedio.darPropina()
 		//assert.equals(1000, propinero.dineroTotal())

 	}
 	
 	test "cliente exigente"{
 		//inicio
 		assert.equals(20,clienteExigente.tiempoEspera())
 		assert.equals(3,clienteExigente.satisfaccion())
 		assert.equals(null, clienteExigente.tragoPedido())
 		
 		//pide un fernet (momentaneamente botella con 1 onza)
 		const fernetTest = new BotellaFernet()
 		clienteExigente.generarTrago(fernetTest)
 		assert.equals(fernetTest, clienteExigente.tragoPedido())
 		
 		//recibe trago
 		//const unTrago = new BotellaFernet() NO SE PUEDE NO ENTIENDE EL METHOD INGREDIENTE
 		//clienteExigente.recibirTrago(unTrago)
 		//assert.notThat(clienteExigente.verificarTrago())
 		
 		//dar propina FUNCA, PERO DA ERROR POR EL game.say POR NO ESTAR EN EL TABLERO
 		//AVERIGUAR FORMA DE PROBAR ESTO SIN QUE SE ROMPA POR ESA TONTERIA
 		assert.equals(0, propinero.dineroTotal())
 		//clienteExigente.darPropina()
 		//assert.equals(1000, propinero.dineroTotal())
 		
 	}
}

describe "barman"{
	test "cocacola con naranja y limon"{
		barman.agregarIngrediente(naranja)
		barman.agregarIngrediente(limon)
		barman.agregarIngrediente(cocacola)
		barman.derecha()
		barman.derecha()
		barman.seleccionar()
		barman.derecha()
		barman.seleccionar()
		barman.izquierda()
		barman.izquierda()
		barman.seleccionar()
		
		setIngredientes.add(naranja)
 		setIngredientes.add(cocacola)
 		setIngredientes.add(limon)
		
		assert.that(coctelera.ingredientes() == setIngredientes)
	}
}
