import silla.*
import sesion.*
import ingredientes.*
import coctelera.*
import cliente.*
import barman.*
import tragos.*

import wollok.game.*

// Ingredientes
//const naranja = new Ingrediente()
//const limon = new Ingrediente()
//const cocacola = new Ingrediente()
//const setIngredientes = #{}
 
// Clientes -> position? deberia pasar la misma posision de la silla...
const silla = new SillaParaTest(position = game.origin())
const clienteConformista = new ClienteConformista(silla = silla)
const clienteMedio = new ClienteMedio(silla = silla)
const clienteExigente = new ClienteExigente(silla = silla)


// Comienzan los tests sobre las Sillas
describe "Pruebas para la clase Silla y sus herederas" {
	
	test "evaluarEstado() sin cliente y con 100% de probabilidades, debe generar cliente" {
		
		assert.notThat(silla.estaOcupada())
		
		silla.evaluarEstado()
		
		assert.that(silla.cliente().toString().contains("un/a  Cliente"))
	}
	
	test "Si la silla ya tiene un cliente, evaluarEstado() conserva el mismo cliente" {
		
		silla.evaluarEstado()
		
		const cliente = silla.cliente()
		
		silla.evaluarEstado()
		
		assert.that(silla.cliente() === cliente)
	}
	
	test "retirarCliente()" {
		
		console.println(silla.cliente())
		
		silla.evaluarEstado()
		
		console.println(silla.cliente())
		
		assert.that(silla.cliente().toString().contains("un/a  Cliente"))
		
		silla.retirarCliente()
		
		console.println(silla.cliente())
		
		assert.notThat(silla.estaOcupada())
	}
}

//Test para la Sesion
describe "Sesion" {
	test "Al iniciarse, todas sus sillas deben iniciarse y tener un cliente random" {
		const sesion = new SesionParaTest()
		
		sesion.iniciar()
		
		assert.equals(sesion.sillas().size(), 4)
		
		game.schedule(1100, {
			sesion.sillas().forEach({ 
				silla => assert.that(silla.cliente().toString().contains("un/a  Cliente"))
			})
		})
	}
}


 
describe "Coctelera" {
 	test "Agregar Ingredientes" {
 		coctelera.agregarIngredientes(naranja)
 		coctelera.agregarIngredientes(limon)
 		coctelera.agregarIngredientes(cola)
 		coctelera.agregarIngredientes(naranja)
 		coctelera.agregarIngredientes(limon)
 		coctelera.agregarIngredientes(cola)
 		coctelera.agregarIngredientes(naranja)
 		assert.equals(7, coctelera.ingredientes().size())
		coctelera.agregarIngredientes(naranja)
 		assert.equals(8, coctelera.ingredientes().size())
 	}
 	
 	test "te pasaste"{
 		coctelera.agregarIngredientes(naranja)
 		coctelera.agregarIngredientes(limon)
 		coctelera.agregarIngredientes(cola)
 		coctelera.agregarIngredientes(naranja)
 		coctelera.agregarIngredientes(limon)
 		coctelera.agregarIngredientes(cola)
 		coctelera.agregarIngredientes(naranja)
 		coctelera.agregarIngredientes(limon)
 		assert.equals(8, coctelera.ingredientes().size())
 		coctelera.agregarIngredientes(cola)
 	}
 	
 	test "Limpiar coctelera" {
 		coctelera.agregarIngredientes(naranja)
 		coctelera.agregarIngredientes(limon)
 		coctelera.agregarIngredientes(cola)
 		coctelera.agregarIngredientes(naranja)
 		assert.equals(4, coctelera.ingredientes().size())
 		coctelera.limpiar()
 		assert.that(coctelera.ingredientes().isEmpty())
 	}
 	
 	test "Compara ingredientes" {
 		coctelera.agregarIngredientes(naranja)
 		coctelera.agregarIngredientes(limon)
 		
 		assert.equals([naranja, limon], coctelera.ingredientes())
 	}
 	
}

describe "cliente"{
 	test "cliente conformista"{
 		//inicio
 		
 		assert.equals(45,clienteConformista.tiempoEspera()) 
 		assert.equals(3,clienteConformista.satisfaccion())
 		assert.equals(null, clienteConformista.tragoPedido())
 		
 		//pide un fernet
 		clienteConformista.generarTrago(fernCola)
 		assert.equals(fernCola, clienteConformista.tragoPedido())
 		
 		//recibe fernet y lo verigica 
 		assert.that(clienteConformista.verificarTrago(fernCola))
 		//recibe fernetCordobes
 		assert.that(clienteConformista.verificarTrago(fernCordobes))
 		//recibe manhattan
 		assert.notThat(clienteConformista.verificarTrago(manhattan))
 		
 		//recibe un trago por la mitad
 		const otroTrago = new Trago(ingredientes = [fernulo,fernulo,naranja, naranja, naranja, ron])
 		assert.notThat(clienteConformista.vasoLleno(otroTrago))
 		//recibe un trago por completo
 		const otroOtroTrago = new Trago(ingredientes = [fernulo,fernulo,naranja, naranja, naranja, ron, ron, ron])
 		assert.that(clienteConformista.vasoLleno(otroOtroTrago))
 		
 	}
 	
 	test "cliente medio"{
 		//inicio
 		assert.equals(30,clienteMedio.tiempoEspera())
 		assert.equals(3,clienteMedio.satisfaccion())
 		assert.equals(null, clienteMedio.tragoPedido())
 		
 		//pide un fernet
 		clienteMedio.generarTrago(fernCola)
 		assert.equals(fernCola, clienteMedio.tragoPedido())
 		
 		//recibe fernet y lo verigica 
 		assert.that(clienteMedio.verificarTrago(fernCola))
 		//recibe fernetCordobes
 		assert.that(clienteMedio.verificarTrago(fernCordobes))
 		//recibe manhattan
 		assert.notThat(clienteMedio.verificarTrago(manhattan))
 		//recibe otro trago
 		const otroTrago = new Trago(ingredientes = [fernulo,fernulo,fernulo, fernulo, ron, ron, ron, naranja])
		const reciboTragoCambio = new Trago(ingredientes = [fernulo,fernulo,fernulo, fernulo, fernulo, ron, ron, naranja])
		const reciboTragoCambio2 = new Trago(ingredientes = [fernulo,fernulo,fernulo, fernulo, fernulo, fernulo, ron, ron])
		const reciboTragoCambio3 = new Trago(ingredientes = [fernulo,fernulo,fernulo, ron, ron, ron, naranja, naranja])
		clienteMedio.generarTrago(otroTrago)
		assert.that(clienteMedio.verificarTrago(otroTrago))
		assert.that(clienteMedio.verificarTrago(reciboTragoCambio))
		assert.notThat(clienteMedio.verificarTrago(reciboTragoCambio2))
		assert.that(clienteMedio.verificarTrago(reciboTragoCambio3))
		
 	}
 	
 	test "cliente exigente"{
 		//inicio
 		assert.equals(16,clienteExigente.tiempoEspera()) 
 		assert.equals(3,clienteExigente.satisfaccion())
 		assert.equals(null, clienteExigente.tragoPedido())
 		
 		//pide un fernet
 		clienteExigente.generarTrago(fernCola)
 		assert.equals(fernCola, clienteExigente.tragoPedido())
 		
 		//ordenar trago que pidio
 		//fernCola = [fernulo, fernulo, fernulo, cola, cola, cola, cola, cola]
 		assert.notEquals([fernulo, fernulo, fernulo, cola, cola, cola, cola, cola],clienteExigente.ordenarTragoPedido())
 		assert.equals([cola, cola, cola, cola, cola, fernulo, fernulo, fernulo],clienteExigente.ordenarTragoPedido())
 		
 		//ordenar trago que recibio
 		//fernCola = [fernulo, fernulo, fernulo, cola, cola, cola, cola, cola]
		assert.notEquals([fernulo, fernulo, fernulo, cola, cola, cola, cola, cola],clienteExigente.ordenarTragoRecibido(fernCola))
 		assert.equals([cola, cola, cola, cola, cola, fernulo, fernulo, fernulo],clienteExigente.ordenarTragoRecibido(fernCola))
				 		
 		//recibe fernet y lo verigica
 		assert.that(clienteExigente.verificarTrago(fernCola))
 		//recibe fernetCordobes
 		assert.notThat(clienteExigente.verificarTrago(fernCordobes))
 		//recibe manhattan
 		assert.notThat(clienteExigente.verificarTrago(manhattan))
 		
 		//recibe otro trago
 		const otroTrago = new Trago(ingredientes = [fernulo,fernulo,naranja, naranja, naranja, ron, ron, ron])
		const otroTragoCambio = new Trago(ingredientes = [fernulo,naranja,naranja, naranja, naranja, ron, ron, ron])
		
		clienteExigente.generarTrago(otroTrago)
		assert.notThat(clienteExigente.verificarTrago(otroTragoCambio))
		
 	}
}

describe "barman"{
	test "cocacola con naranja y limon"{
		
		barman.derecha()
		barman.derecha()
		barman.seleccionar()
		barman.derecha()
		barman.seleccionar()
		barman.izquierda()
		barman.izquierda()
		barman.seleccionar()
		
		//hay que pensarlo
	}
}

describe "propinero"{
	test "propinero"{
		
		assert.equals(0,propinero.dinero())
		propinero.entregarPropina(100)
		assert.equals(100,propinero.dinero())
		const sesion = new SesionParaTest()
		//assert.notThat(propinero.objetivoCumplido())
		
	}
}